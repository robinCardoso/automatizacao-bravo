<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatizador Bravo - Sistema de Automa√ß√£o Corporativa</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- MENU SUPERIOR FIXO -->
        <header class="top-menu">
            <div class="logo">
                <span>ü§ñ</span>
                <span>AUTOMATIZADOR BRAVO</span>
            </div>
            <div class="user-info">
                Sistema Corporativo de Automa√ß√£o
            </div>
        </header>

        <!-- LAYOUT PRINCIPAL -->
        <div class="main-layout">
            <!-- SIDEBAR FIXA -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3>üìÇ NAVEGA√á√ÉO</h3>
                    <div class="sidebar-nav">
                        <button id="btnNavAuth" class="nav-btn active" onclick="Dashboard.switchView('automation')">üè†
                            Automa√ß√£o</button>
                        <button id="btnNavDash" class="nav-btn" onclick="Dashboard.switchView('dashboard')">üìä Painel de
                            Resultados</button>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>üìä STATUS DO SISTEMA</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Automa√ß√£o:</span>
                            <span class="status-value" id="automationStatus">PARADA</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Sess√µes Ativas:</span>
                            <span class="status-value" id="sessionStatus">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Sites Configurados:</span>
                            <span class="status-value" id="sitesCount">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">√öltima Execu√ß√£o:</span>
                            <span class="status-value" id="lastRun">Nunca</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3>‚ö° PERFORMANCE</h3>
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">Tempo M√©dio:</span>
                            <span class="status-value" id="avgTime">-</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Taxa de Sucesso:</span>
                            <span class="status-value" id="successRate">-</span>
                        </div>
                    </div>
                </div>

                <!-- WIDGET DE AGENDAMENTOS (NOVO) -->
                <div class="sidebar-section" id="schedulerWidget">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h3 style="margin: 0;">‚è±Ô∏è AGENDAMENTOS</h3>
                        <button id="globalScheduleToggle" class="btn-toggle-small" onclick="toggleGlobalSchedule()"
                            title="Pausar/Retomar Agendamentos">‚è∏Ô∏è</button>
                    </div>
                    <div id="nextSchedulesList" style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="font-size: 10px; color: #95a5a6; text-align: center; padding: 10px;">Nenhum
                            agendamento ativo</div>
                    </div>
                </div>
            </aside>

            <!-- CONTE√öDO PRINCIPAL (MODULAR) -->
            <main class="main-content">
                <!-- VIEW 1: AUTOMA√á√ÉO (COM SUB-TABS) -->
                <div id="view-automation" class="app-view active-view">
                    <!-- √ÅREA DE CONTROLES COMPARTILHADA -->
                    <div id="automation-controls-area" class="automation-controls-wrapper">
                        <section class="premium-card controls-card">
                            <div class="card-body-row">
                                <div class="preset-selector-group">
                                    <label class="premium-label">Fluxo de Opera√ß√£o (Preset)</label>
                                    <div class="input-with-button">
                                        <select id="mainPresetSelector" class="premium-select">
                                            <option value="">Selecione um Preset...</option>
                                        </select>
                                        <button class="btn-refresh" onclick="loadPresetsToMain()"
                                            title="Recarregar">üîÑ</button>
                                    </div>
                                </div>

                                <div class="main-actions-group">
                                    <button id="startBtn" class="btn-action btn-start" onclick="startAutomation()">‚ñ∂
                                        INICIAR</button>
                                    <button id="stopBtn" class="btn-action btn-stop" onclick="stopAutomation()"
                                        disabled>‚èπ
                                        PARAR</button>
                                    <div class="action-divider"></div>
                                    <button class="btn-circle" onclick="openConfig()" title="Configura√ß√µes">‚öô</button>
                                    <button class="btn-circle" onclick="manageSessions()" title="Sess√µes">üîê</button>
                                    <button class="btn-circle" onclick="testConnection()" title="Testar">üîß</button>
                                </div>
                            </div>
                        </section>
                    </div>

                    <!-- SUB-NAVEGA√á√ÉO INTERNA (TABS) -->
                    <div class="internal-tabs">
                        <button id="tabBtnAudit" class="tab-btn active" onclick="Dashboard.switchTab('audit')">üìã
                            Auditoria de Integridade</button>
                        <button id="tabBtnConsole" class="tab-btn" onclick="Dashboard.switchTab('console')">üñ•Ô∏è Console
                            de Opera√ß√µes</button>
                    </div>

                    <!-- CONTE√öDO DAS TABS -->
                    <div class="tabs-content">
                        <!-- TAB: AUDITORIA -->
                        <div id="tab-audit" class="internal-tab active">

                            <!-- √ÅREA 2: INTELIG√äNCIA DE AUDITORIA (EMPRESA A EMPRESA) -->
                            <section class="premium-card audit-card">
                                <div class="premium-card-header">
                                    <div class="header-title">
                                        <span class="icon">üìä</span>
                                        <span>AUDITORIA DE INTEGRIDADE (14+ EMPRESAS)</span>
                                    </div>
                                    <div id="auditStatus" class="status-badge badge-waiting">Aguardando In√≠cio</div>
                                </div>
                                <div class="audit-viewport">
                                    <table class="premium-table">
                                        <thead>
                                            <tr>
                                                <th width="60">UF</th>
                                                <th>EMPRESA / FILIAL</th>
                                                <th width="120" style="text-align: center;">LINHAS</th>
                                                <th width="150" style="text-align: center;">MUDAN√áAS</th>
                                                <th width="100" style="text-align: center;">STATUS</th>
                                                <th width="120" style="text-align: right;">A√á√ÉO</th>
                                            </tr>
                                        </thead>
                                        <tbody id="auditTableBody">
                                            <!-- Preenchido dinamicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </section>
                        </div>

                        <!-- TAB: CONSOLE -->
                        <div id="tab-console" class="internal-tab" style="display: none;">
                            <section class="premium-card console-card" style="flex: 1;">
                                <div class="premium-card-header console-header">
                                    <div class="header-title">
                                        <span class="icon">üñ•Ô∏è</span>
                                        <span>CONSOLE DE OPERA√á√ïES EM TEMPO REAL</span>
                                    </div>
                                    <div class="header-actions">
                                        <button class="btn-text-only"
                                            onclick="logArea.textContent = '> Console pronto...'">Limpar</button>
                                        <button class="btn-text-only" onclick="toggleSummary()">Exibir Workflow</button>
                                    </div>
                                </div>
                                <div class="console-viewport" style="flex: 1;">
                                    <div class="log-content premium-font" id="logArea"></div>

                                    <!-- PAINEL DE WORKFLOW -->
                                    <div id="workflowSummary" class="workflow-side-panel" style="display: none;">
                                        <div class="overlay-header">Progresso do Workflow</div>
                                        <div id="summarySteps"></div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div> <!-- tabs-content -->
                </div> <!-- view-automation -->

                <!-- VIEW 2: DASHBOARD (NOVO) -->
                <div id="view-dashboard" class="app-view">
                    <section class="premium-card">
                        <div class="premium-card-header">
                            <div class="header-title">
                                <span class="icon">üìä</span>
                                <span>PAINEL DE RESULTADOS CONSOLIDADOS</span>
                            </div>
                            <div class="header-actions">
                                <select id="dashMonthFilter" class="premium-select-small"
                                    onchange="Dashboard.loadDashboard()">
                                    <option value="">Todos os Meses</option>
                                </select>
                                <select id="dashBrandFilter" class="premium-select-small"
                                    onchange="Dashboard.loadDashboard()">
                                    <option value="">Todas as Marcas</option>
                                </select>
                                <select id="dashCustomerFilter" class="premium-select-small"
                                    onchange="Dashboard.loadDashboard()">
                                    <option value="">Todos os Clientes</option>
                                </select>
                                <select id="dashGroupFilter" class="premium-select-small"
                                    onchange="Dashboard.loadDashboard()">
                                    <option value="">Todos os Grupos</option>
                                </select>
                                <div class="report-toggle-group">
                                    <button class="btn-toggle active" id="btnTypeVENDA"
                                        onclick="Dashboard.setReportType('VENDA')">VENDAS</button>
                                    <button class="btn-toggle" id="btnTypePEDIDO"
                                        onclick="Dashboard.setReportType('PEDIDO')">PEDIDOS</button>
                                </div>
                                <button id="btnUnknownRefs" class="premium-btn danger-outline"
                                    style="display: none; padding: 6px 10px; margin-right: 8px; font-size: 11px;"
                                    onclick="Dashboard.openUnknownRefsModal()">
                                    <i class="fas fa-exclamation-triangle"></i> <span id="btnUnknownRefsCount">0</span>
                                </button>
                                <input type="hidden" id="dashReportType" value="VENDA">
                                <button class="btn-refresh" onclick="Dashboard.loadDashboard()">üîÑ</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="dashboard-summary" id="dashSummary">
                                <div class="stat-box">
                                    <span class="stat-label">Valor Total</span>
                                    <span class="stat-value" id="dashTotalValue">R$ 0,00</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-label">Registros</span>
                                    <span class="stat-value" id="dashTotalRecords">0</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-label">Cresc. Valor</span>
                                    <span class="stat-value" id="dashValueGrowthValue">0%</span>
                                    <span class="growth-icon" id="dashValueGrowthIcon">-</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-label">Cresc. Registros</span>
                                    <span class="stat-value" id="dashRecordGrowthValue">0%</span>
                                    <span class="growth-icon" id="dashRecordGrowthIcon">-</span>
                                </div>
                                <div class="stat-box">
                                    <span class="stat-label">√öltima Atualiza√ß√£o</span>
                                    <span class="stat-value" id="dashLastUpdate">-</span>
                                </div>
                            </div>

                            <div class="dashboard-grid">
                                <div class="chart-card">
                                    <h4>üìÖ Evolu√ß√£o de Volume (Tempo)</h4>
                                    <div class="chart-content">
                                        <canvas id="chartDate"></canvas>
                                    </div>
                                </div>
                                <div class="chart-card">
                                    <h4>üìç Volume por Grupo/UF</h4>
                                    <div class="chart-content">
                                        <canvas id="chartGroup"></canvas>
                                    </div>
                                </div>
                                <div class="chart-card wide">
                                    <h4>üèÜ Top 10 Categorias / Produtos</h4>
                                    <div class="chart-content">
                                        <canvas id="chartCategory"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </main>
        </div>

        <!-- FOOTER FIXO COM A√á√ïES PRINCIPAIS -->
        <footer class="fixed-footer">
            <div>
                <button class="btn btn-secondary" onclick="showHelp()">
                    ‚ùì AJUDA
                </button>
            </div>
            <div>
                <span>Vers√£o 1.0.0 | ¬© 2026 Automatizador Bravo</span>
            </div>
            <div>
                <button class="btn btn-primary" onclick="exportLogs()">
                    üì§ EXPORTAR LOGS
                </button>
            </div>
        </footer>

        <!-- MODAL DE CONFIGURA√á√ïES REESTRUTURADO -->
        <div id="configModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Configura√ß√µes do Sistema</h3>
                    <button class="btn btn-secondary" style="padding: 5px 10px; min-width: 0;"
                        onclick="closeModal('configModal')">√ó</button>
                </div>

                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchConfigTab('presetsTab')"
                        id="tabBtnPresets">Predefini√ß√µes (Presets)</button>
                    <button class="tab-btn" onclick="switchConfigTab('sitesTab')" id="tabBtnSites">Sites e
                        A√ß√µes</button>
                    <button class="tab-btn" onclick="switchConfigTab('alertsTab')" id="tabBtnAlertas">üîî
                        Alertas</button>
                    <button class="tab-btn" onclick="switchConfigTab('exportImportTab')" id="tabBtnExportImport">üì§
                        Exportar/Importar</button>
                </div>

                <div class="modal-body">
                    <!-- ABA DE PRESETS -->
                    <div id="presetsTab" class="config-tab">
                        <div class="config-section-title">Op√ß√µes Gerais de Execu√ß√£o</div>
                        <div class="form-group"
                            style="background: #fcfdfe; border: 1px solid #dce4ec; border-radius: 8px; padding: 15px;">
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                <input type="checkbox" id="cfgHeadless"
                                    style="width: 18px; height: 18px; accent-color: #3498db;">
                                <div style="display: flex; flex-direction: column;">
                                    <span style="font-size: 13px; font-weight: 600; color: #2c3e50;">Modo Invis√≠vel
                                        (Headless)</span>
                                    <span style="font-size: 11px; color: #7f8c8d;">Oculta o navegador durante a execu√ß√£o
                                        da automa√ß√£o.</span>
                                </div>
                            </label>
                        </div>

                        <div class="config-section-title">Gerenciamento de Presets</div>
                        <div id="presetsList"
                            style="margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px;">
                            <!-- Lista de presets preenchida via JS -->
                        </div>

                        <button class="btn btn-primary" style="width: 100%;" onclick="showPresetForm()">
                            ‚ûï Criar Nova Predefini√ß√£o
                        </button>

                        <!-- FORMUL√ÅRIO DE PRESET (POPUP/OVERLAY INTERNO) -->
                        <div id="presetForm"
                            style="display: none; margin-top: 25px; padding-top: 25px; border-top: 2px dashed #f4f7f9;">
                            <div class="config-section-title">Dados da Predefini√ß√£o</div>
                            <input type="hidden" id="presetId">

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Nome Identificador</label>
                                    <input type="text" id="pName" class="form-control"
                                        placeholder="Ex: Bravo Vendas Filial 01">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Categoria/Tipo</label>
                                    <select id="pType" class="form-control">
                                        <option value="vendas">M√≥dulo de Vendas</option>
                                        <option value="pedidos">M√≥dulo de Pedidos</option>
                                        <option value="fiscal">M√≥dulo Fiscal</option>
                                        <option value="outros">Outros M√≥dulos</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Usu√°rio / E-mail</label>
                                    <input type="text" id="pLogin" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Senha de Acesso</label>
                                    <input type="password" id="pPass" class="form-control">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Pasta de Destino (Arquivos Consolidados)</label>
                                <div class="input-with-button">
                                    <input type="text" id="pDestination" class="form-control"
                                        placeholder="C:\Caminho\Para\Salvar\Excel">
                                    <button class="btn btn-secondary"
                                        onclick="Utils.log('Dica: Cole o caminho da pasta aqui para centralizar os arquivos masters.')"
                                        style="min-width: 40px;" title="Ajuda">üí°</button>
                                </div>
                                <small style="font-size: 10px; color: #7f8c8d; margin-top: 4px; display: block;">
                                    Se deixado vazio, os arquivos mestres ser√£o salvos na pasta padr√£o do sistema.
                                </small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Vincular aos Workflows</label>
                                <div id="presetSiteLinks"
                                    style="max-height: 150px; overflow-y: auto; background: #fcfdfe; border: 1px solid #dce4ec; border-radius: 8px; padding: 12px; display: flex; flex-direction: column; gap: 8px;">
                                    <small style="color: #95a5a6;">Nenhum site dispon√≠vel.</small>
                                </div>
                            </div>

                            <!-- NOVA SE√á√ÉO: AUDITORIA E DASHBOARD DO PRESET -->
                            <div class="config-section-title">Auditoria e Dashboard (Centralizado)</div>
                            <div class="minimal-card"
                                style="margin-bottom: 20px; background: #f8fbff; border: 1px solid #d0e1f3;">
                                <div class="form-group">
                                    <label class="form-label">Chaves Prim√°rias (Deduplica√ß√£o / Audit)</label>
                                    <input type="text" id="pPrimaryKeys" class="form-control"
                                        placeholder="ID, NUMERO, NOTA (Separadas por v√≠rgula)">
                                    <small style="font-size: 10px; color: #7f8c8d;">Define quais colunas juntas
                                        identificam um registro √∫nico para evitar duplicados.</small>
                                </div>

                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px;">
                                    <div class="form-group">
                                        <label class="form-label">Coluna de Valor</label>
                                        <input type="text" id="pMapValue" class="form-control"
                                            placeholder="Ex: VALOR_TOTAL">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Coluna de Data</label>
                                        <input type="text" id="pMapDate" class="form-control"
                                            placeholder="Ex: DT_EMISSAO">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Coluna de Grupo (UF/Site)</label>
                                        <input type="text" id="pMapGroup" class="form-control"
                                            placeholder="Ex: ORIGEM_UF">
                                    </div>
                                </div>
                            </div>

                            <!-- SE√á√ÉO DE AGENDAMENTO (COMPACTADO) -->
                            <div class="config-section-title"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <span>Agendamento Autom√°tico</span>
                                <label
                                    style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin: 0; font-weight: normal; text-transform: none;">
                                    <input type="checkbox" id="pSchedEnabled"
                                        style="width: 14px; height: 14px; accent-color: #3498db;"
                                        onchange="toggleScheduleOptions()">
                                    <span style="font-size: 11px; color: #7f8c8d;">Ativar para este Preset</span>
                                </label>
                            </div>

                            <div id="schedOptions"
                                style="display: none; background: #f8f9fa; border: 1px solid #dce4ec; border-radius: 8px; padding: 12px; margin-bottom: 20px;">
                                <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <label class="form-label">Modo de Repeti√ß√£o</label>
                                        <select id="pSchedMode" class="form-control" onchange="toggleScheduleMode()">
                                            <option value="interval">Por Intervalo (ex: cada 3h)</option>
                                            <option value="fixed">Hor√°rios Fixos (ex: 08:00)</option>
                                        </select>
                                    </div>

                                    <div style="flex: 1; min-width: 200px;">
                                        <label class="form-label">Pol√≠tica de Compensa√ß√£o</label>
                                        <select id="pCompensationPolicy" class="form-control">
                                            <option value="immediate">Executar imediatamente</option>
                                            <option value="skip">Ignorar se atrasada demais</option>
                                            <option value="delayed">Apenas para pequenos atrasos</option>
                                        </select>
                                    </div>

                                    <div id="intervalGroup" style="flex: 1; min-width: 150px;">
                                        <label class="form-label">Executar a cada (Horas)</label>
                                        <input type="number" id="pSchedInterval" class="form-control" min="1" max="24"
                                            value="3">
                                    </div>

                                    <div id="fixedGroup" style="display: none; flex: 1.5; min-width: 250px;">
                                        <label class="form-label">Gest√£o de Hor√°rios</label>
                                        <div style="display: flex; gap: 8px;">
                                            <input type="time" id="pSchedTimeInput" class="form-control">
                                            <button class="btn btn-primary" onclick="addFixedTime()"
                                                style="padding: 0 15px; height: 38px; white-space: nowrap;">ADICIONAR</button>
                                        </div>
                                    </div>
                                </div>

                                <div id="compensationDelayGroup" style="flex: 1; min-width: 150px; margin-top: 10px;">
                                    <label class="form-label">Tempo m√°x. compensa√ß√£o (horas)</label>
                                    <input type="number" id="pMaxCompensationDelay" class="form-control" min="0"
                                        max="168" value="24">
                                    <small style="font-size: 10px; color: #7f8c8d; display: block; margin-top: 4px;">
                                        Tempo limite para executar tarefas atrasadas (0 = sem limite)
                                    </small>
                                </div>

                                <div id="fixedTimesBadges"
                                    style="display: none; flex-wrap: wrap; gap: 6px; margin-top: 10px; padding: 8px; background: #ffffff; border: 1px solid #dce4ec; border-radius: 8px; min-height: 40px;">
                                    <!-- Badges de hor√°rios aparecer√£o aqui -->
                                </div>

                                <div id="nextRunPreview"
                                    style="font-size: 10px; color: #3498db; margin-top: 8px; font-weight: 600;"></div>
                            </div>

                            <div class="form-row" style="margin-top: 10px;">
                                <button class="btn btn-success" onclick="handleSavePreset()">Salvar
                                    Predefini√ß√£o</button>
                                <button class="btn btn-secondary" onclick="hidePresetForm()">Cancelar Edi√ß√£o</button>
                            </div>
                        </div>
                    </div>

                    <!-- ABA DE ALERTAS (UPGRADED) -->
                    <div id="alertsTab" class="config-tab" style="display: none;">
                        <div class="config-section-title">Configura√ß√µes de Notifica√ß√£o (E-mail)</div>

                        <div class="minimal-card" style="margin-bottom: 15px; border-left: 4px solid #e74c3c;">
                            <label style="display: flex; align-items: center; gap: 12px; cursor: pointer; margin: 0;">
                                <input type="checkbox" id="cfgEmailEnabled" style="width: 20px; height: 20px;">
                                <div>
                                    <div style="font-weight: bold; color: #2c3e50;">Ativar Notifica√ß√µes Autom√°ticas
                                    </div>
                                    <div style="font-size: 11px; color: #7f8c8d;">Enviar relat√≥rio detalhado ao final de
                                        cada execu√ß√£o.</div>
                                </div>
                            </label>
                        </div>

                        <!-- SMTP PRIM√ÅRIO -->
                        <div class="minimal-card" style="margin-bottom: 15px;">
                            <h4 style="margin-top: 0; display: flex; align-items: center; gap: 10px;">
                                üöÄ Servidor SMTP Prim√°rio
                                <select id="cfgSmtpAuthType" class="form-control"
                                    style="width: auto; height: 24px; font-size: 11px; padding: 0 5px;"
                                    onchange="toggleSmtpAuthDisplay()">
                                    <option value="login">Login Tradicional</option>
                                    <option value="oauth2">Google OAuth2</option>
                                </select>
                            </h4>

                            <div
                                style="display: grid; grid-template-columns: 2fr 1fr 2fr; gap: 12px; margin-bottom: 12px;">
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Host SMTP</label>
                                    <input type="text" id="cfgSmtpHost" class="form-control"
                                        placeholder="smtp.gmail.com">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Porta</label>
                                    <input type="number" id="cfgSmtpPort" class="form-control" placeholder="465">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Usu√°rio / E-mail</label>
                                    <input type="text" id="cfgSmtpUser" class="form-control"
                                        placeholder="contato@empresa.com">
                                </div>
                            </div>

                            <!-- CAMPOS LOGIN TRADICIONAL -->
                            <div id="smtpAuthLogin" style="display: block;">
                                <div class="form-group" style="margin-bottom: 12px;">
                                    <label class="form-label">Senha / App Password</label>
                                    <input type="password" id="cfgSmtpPass" class="form-control"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                </div>
                            </div>

                            <!-- CAMPOS OAUTH2 -->
                            <div id="smtpAuthOAuth2" style="display: none;">
                                <div
                                    style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                                    <div class="form-group" style="margin: 0;">
                                        <label class="form-label">Client ID</label>
                                        <input type="password" id="cfgSmtpClientId" class="form-control">
                                    </div>
                                    <div class="form-group" style="margin: 0;">
                                        <label class="form-label">Client Secret</label>
                                        <input type="password" id="cfgSmtpClientSecret" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Refresh Token</label>
                                    <input type="password" id="cfgSmtpRefreshToken" class="form-control">
                                </div>
                            </div>

                            <!-- INDICADOR DE STATUS -->
                            <div id="smtp-status-indicator"
                                style="margin-top: 10px; padding: 10px; border-radius: 6px; display: none; font-size: 11px;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span id="smtp-status-icon">‚è≥</span>
                                    <span id="smtp-status-text">...</span>
                                </div>
                            </div>

                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-secondary-minimal" onclick="testSmtpConnection()"
                                    style="flex: 1;">üß™ Testar Prim√°rio</button>
                                <button class="btn btn-secondary-minimal" onclick="sendTestEmail()" style="flex: 1;">‚úâÔ∏è
                                    E-mail de Teste</button>
                            </div>
                        </div>

                        <!-- FALLBACK E CONFIGURA√á√ïES AVAN√áADAS -->
                        <div class="minimal-card">
                            <h4 style="margin-top: 0;">‚öôÔ∏è Configura√ß√µes Avan√ßadas e Fallback</h4>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">E-mail Destinat√°rio (Padr√£o)</label>
                                    <input type="text" id="cfgEmailRecipient" class="form-control"
                                        placeholder="admin@empresa.com">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Tentativas de Reenvio</label>
                                    <input type="number" id="cfgEmailRetry" class="form-control" value="3" min="1"
                                        max="10">
                                </div>
                            </div>

                            <details style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                                <summary style="cursor: pointer; font-size: 12px; font-weight: bold; color: #34495e;">
                                    Configurar Servidor de Fallback (Opcional)</summary>
                                <div style="padding-top: 10px;">
                                    <p style="font-size: 10px; color: #7f8c8d; margin-bottom: 10px;">Este servidor ser√°
                                        usado se o prim√°rio falhar.</p>
                                    <div
                                        style="display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 10px;">
                                        <input type="text" id="cfgSmtpFallbackHost" class="form-control"
                                            placeholder="Host Fallback (ex: smtp.sendgrid.net)">
                                        <input type="number" id="cfgSmtpFallbackPort" class="form-control"
                                            placeholder="587">
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                        <input type="text" id="cfgSmtpFallbackUser" class="form-control"
                                            placeholder="Usu√°rio Fallback">
                                        <input type="password" id="cfgSmtpFallbackPass" class="form-control"
                                            placeholder="Senha Fallback">
                                    </div>
                                </div>
                            </details>

                            <div style="display: flex; gap: 20px; margin-top: 20px; font-size: 12px;">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="cfgShowLogo" checked> Exibir Logotipo no E-mail
                                </label>
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" id="cfgCompactLayout"> Layout Compacto
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- ABA DE EXPORTA√á√ÉO/IMPORTA√á√ÉO -->
                    <div id="exportImportTab" class="config-tab" style="display: none;">
                        <div class="config-section-title">Exporta√ß√£o e Importa√ß√£o de Configura√ß√µes</div>

                        <div class="minimal-card export-section">
                            <h4>üì§ Exportar Todas as Configura√ß√µes</h4>
                            <p>Crie um backup completo de todos os seus presets, sites e configura√ß√µes do sistema.</p>
                            <button class="btn btn-primary-minimal" onclick="exportAllConfigs()">
                                üì§ EXPORTAR CONFIGURA√á√ïES PARA ARQUIVO JSON
                            </button>
                        </div>

                        <div class="minimal-card import-section">
                            <h4>üì• Importar Configura√ß√µes</h4>
                            <p>Restaure suas configura√ß√µes a partir de um arquivo JSON exportado anteriormente.</p>
                            <div class="import-controls">
                                <input type="file" id="importConfigFile" accept=".json">
                                <button class="btn btn-success-minimal" onclick="importConfigs()">
                                    üì• IMPORTAR
                                </button>
                            </div>
                            <small>
                                ‚ö†Ô∏è A importa√ß√£o ir√° mesclar os presets existentes com os novos. Presets com o mesmo ID
                                ser√£o atualizados.
                            </small>
                        </div>

                        <div class="minimal-card warning-section">
                            <h4>‚ö†Ô∏è Avisos Importantes</h4>
                            <ul>
                                <li>O arquivo exportado cont√©m senhas em texto claro - mantenha-o seguro</li>
                                <li>Fa√ßa backup regularmente para evitar perda de dados</li>
                                <li>Importa√ß√µes substituem presets existentes com o mesmo ID</li>
                            </ul>
                        </div>
                    </div>

                    <!-- ABA DE SITES / A√á√ïES -->
                    <div id="sitesTab" class="config-tab" style="display: none;">
                        <div class="config-section-title">Sites e Workflows Mapeados</div>
                        <div id="sitesList"
                            style="margin-bottom: 20px; display: flex; flex-direction: column; gap: 10px;">
                            <!-- Lista de sites preenchida via JS -->
                        </div>

                        <button class="btn btn-primary" style="width: 100%;" onclick="showSiteForm()">
                            ‚ûï Mapear Novo Site/A√ß√£o
                        </button>

                        <!-- FORMUL√ÅRIO DE SITE (OCULTO) -->
                        <div id="siteForm"
                            style="display: none; margin-top: 25px; padding-top: 25px; border-top: 2px dashed #f4f7f9;">
                            <div class="config-section-title">Defini√ß√µes do Site</div>
                            <input type="hidden" id="siteId">

                            <div
                                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 5px;">
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Nome Amig√°vel</label>
                                    <input type="text" id="sName" class="form-control" placeholder="Ex: Bravo ERP">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">URL de Login</label>
                                    <input type="text" id="sLoginUrl" class="form-control" placeholder="https://...">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Pasta de Destino (Opcional)</label>
                                    <input type="text" id="sDest" class="form-control" placeholder="C:\Caminho\Salvar">
                                </div>
                            </div>
                            <small style="color: #95a5a6; font-size: 9px; display: block; margin-bottom: 12px;">Define
                                como o arquivo ser√° nomeado e salvo automaticamente.</small>

                            <div class="config-section-title">Seletores e Identifica√ß√£o</div>
                            <div
                                style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 12px;">
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Seletor de Login</label>
                                    <input type="text" id="sUserField" class="form-control"
                                        placeholder="input[name='login']">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Seletor de Senha</label>
                                    <input type="text" id="sPassField" class="form-control" placeholder="#password">
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Bot√£o Entrar</label>
                                    <input type="text" id="sLoginBtn" class="form-control" placeholder=".btn-entrar">
                                </div>
                            </div>

                            <div
                                style="display: grid; grid-template-columns: 80px 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">UF</label>
                                    <select id="sUF" class="form-control">
                                        <option value="AC">AC</option>
                                        <option value="AL">AL</option>
                                        <option value="AP">AP</option>
                                        <option value="AM">AM</option>
                                        <option value="BA">BA</option>
                                        <option value="CE">CE</option>
                                        <option value="DF">DF</option>
                                        <option value="ES">ES</option>
                                        <option value="GO">GO</option>
                                        <option value="MA">MA</option>
                                        <option value="MT">MT</option>
                                        <option value="MS">MS</option>
                                        <option value="MG">MG</option>
                                        <option value="PA">PA</option>
                                        <option value="PB">PB</option>
                                        <option value="PR">PR</option>
                                        <option value="PE">PE</option>
                                        <option value="PI">PI</option>
                                        <option value="RJ">RJ</option>
                                        <option value="RN">RN</option>
                                        <option value="RS">RS</option>
                                        <option value="RO">RO</option>
                                        <option value="RR">RR</option>
                                        <option value="SC" selected>SC</option>
                                        <option value="SP">SP</option>
                                        <option value="SE">SE</option>
                                        <option value="TO">TO</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Gera√ß√£o de Relat√≥rio (SSP)</label>
                                    <select id="sReportType" class="form-control">
                                        <option value="">Nenhum (Comum)</option>
                                        <option value="VENDA">VENDA (Consolidado)</option>
                                        <option value="PEDIDO">PEDIDO (Controle)</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin: 0;">
                                    <label class="form-label">Chaves Prim√°rias</label>
                                    <input type="text" id="sPrimaryKeys" class="form-control"
                                        placeholder="Doc Item, id.1">
                                </div>
                            </div>

                            <div class="config-section-title">Passos Adicionais (P√≥s-Login)</div>
                            <div style="display: flex; gap: 5px; margin-bottom: 5px; padding: 0 5px;">
                                <small
                                    style="width: 100px; color: #95a5a6; font-weight: 700; font-size: 9px; text-transform: uppercase;">A√ß√£o</small>
                                <small
                                    style="flex: 1; color: #95a5a6; font-weight: 700; font-size: 9px; text-transform: uppercase;">Seletor
                                    CSS ou URL</small>
                                <small
                                    style="width: 180px; color: #95a5a6; font-weight: 700; font-size: 9px; text-transform: uppercase;">Texto
                                    / Valor</small>
                                <small style="width: 25px;"></small>
                                <small
                                    style="width: 30px; color: #95a5a6; font-weight: 700; font-size: 9px; text-transform: uppercase;"
                                    title="Continuar em caso de erro">OPT</small>
                            </div>
                            <div id="stepsList"
                                style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px;">
                                <!-- Lista de passos preenchida via JS -->
                            </div>
                            <button class="btn btn-secondary" style="font-size: 10px; padding: 6px 12px;"
                                onclick="addStepRow()">
                                ‚ûï Adicionar Passo de Execu√ß√£o
                            </button>

                            <div class="form-row" style="margin-top: 25px;">
                                <button class="btn btn-success" onclick="handleSaveSite()">Salvar Site e
                                    Workflows</button>
                                <button class="btn btn-secondary" onclick="hideSiteForm()">Descartar
                                    Altera√ß√µes</button>
                            </div>
                        </div>
                    </div>

                    <div class="config-section-title">Par√¢metros Avan√ßados</div>
                    <div class="form-row" style="grid-template-columns: 1fr 1fr 1fr;">
                        <div class="form-group">
                            <label class="form-label">Intervalo (ms)</label>
                            <input type="number" id="actionDelay" class="form-control" value="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tentativas</label>
                            <input type="number" id="maxRetries" class="form-control" value="3">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Timeout (s)</label>
                            <input type="number" id="timeout" class="form-control" value="30">
                        </div>
                    </div>
                </div>

                <div class="modal-footer" id="configModalFooter">
                    <button class="btn btn-secondary" onclick="closeModal('configModal')">Fechar</button>
                    <button class="btn btn-success" onclick="saveConfig()">Aplicar Altera√ß√µes</button>
                </div>
            </div>
        </div>

        <!-- MODAL DE GERENCIAMENTO DE SESS√ïES -->
        <div id="sessionModal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîê GERENCIAMENTO DE SESS√ïES</h3>
                    <button class="btn btn-secondary" onclick="closeModal('sessionModal')">√ó</button>
                </div>
                <div class="modal-body">
                    <div class="control-panel">
                        <div class="control-header">SESS√ïES SALVAS</div>
                        <div id="sessionsList" style="margin-bottom: 20px;">
                            <!-- Lista de sess√µes ser√° preenchida dinamicamente -->
                            <div style="padding: 15px; background: #f8f9fa; border-radius: 4px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>Site Exemplo</strong><br>
                                        <small>√öltimo acesso: Hoje 10:30</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-success"
                                            style="padding: 5px 10px; font-size: 12px;">USAR</button>
                                        <button class="btn btn-danger"
                                            style="padding: 5px 10px; font-size: 12px;">EXCLUIR</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="newSession()">
                                ‚ûï NOVA SESS√ÉO
                            </button>
                            <button class="btn btn-warning" onclick="clearAllSessions()">
                                üóëÔ∏è LIMPAR TODAS
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" onclick="closeModal('sessionModal')">FECHAR</button>
                </div>
            </div>
        </div>
    </div>


    <!-- MODAL DE RELAT√ìRIO DE ERROS / REFS DESCONHECIDAS -->
    <div id="unknownRefsModal" class="premium-modal" style="display: none;">
        <div class="premium-modal-content" style="max-width: 600px;">
            <div class="premium-modal-header">
                <h2 style="color: #e74c3c;"><i class="fas fa-exclamation-triangle"></i> Produtos N√£o Identificados</h2>
                <span class="close-modal"
                    onclick="document.getElementById('unknownRefsModal').style.display='none'">&times;</span>
            </div>
            <div class="premium-modal-body">
                <p style="margin-bottom: 15px; color: #7f8c8d;">
                    Os seguintes c√≥digos de produto foram encontrados no arquivo de PEDIDOS mas n√£o possuem cadastro de
                    Marca/Grupo no sistema (baseado no hist√≥rico de Vendas).
                </p>
                <div style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead style="background: #f8f9fa; position: sticky; top: 0;">
                            <tr>
                                <th style="padding: 8px; text-align: left; border-bottom: 2px solid #ddd;">Refer√™ncia
                                </th>
                                <th style="padding: 8px; text-align: center; border-bottom: 2px solid #ddd;">Ocorr√™ncias
                                </th>
                            </tr>
                        </thead>
                        <tbody id="unknownRefsTableBody">
                            <!-- Items ser√£o inseridos aqui -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="premium-modal-footer">
                <button class="premium-btn secondary"
                    onclick="document.getElementById('unknownRefsModal').style.display='none'">Fechar</button>
            </div>
        </div>
    </div>

    <script type="module" src="./main.js"></script>
</body>

</html>